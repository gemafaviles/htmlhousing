{
  "hash": "511937923d246a7bc20b55e0ae8e9cd8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Trabajando con datos simulados: Toledo\"\nauthor: \"Gema Fernández-Avilés Calderón\"\n# format: html\nengine: knitr  ## LO AÑADO AHORA\nformat: live-html\nwebr:\n  packages:\n    - tidyverse # Para manipular los datos\n    - leaflet # Para crear mapas interactivos\n    - leaflet.extras # Para crear extesiones en mapas interactivos\n    - gstat  # Para realizar interpolaciones espaciales\n    - raster # Para trabajar con datos raster\n    - igraph # Para trabajar con grafos\n    - tm     # Para trabajar con texto\n    - wordcloud # Para crear nubes de palabras\nresources:\n    - datos\nembed-resources: true \ntheme: cerulean\nhighlight-style: ayu-mirage\nself-contained: true\ndate: \"2025-11-17\"\ncode-link: true\nnumber-sections: true\nexecute:\n  code-overflow: scroll\n  echo: true\n  eval: true\n  output: true\n  include: true\n  freeze: auto\n  fig-height: 5\n  warning: false\n  code-fold: true\n  comment: \"#>\"\n  code-line-numbers: true\n  code-copy: true\n#bibliography: biblio.bib\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n<!-- Poner esto en la terminal para que funcione el quarto-live -->\n<!-- Tools->Terminal->Move Focus to Terminal -->\n<!-- quarto add r-wasm/quarto-live -->\n\n\n# Cargamos los paquetes **R** necesarios para el análisis de los datos.\n\n\n\n::: {.cell}\n```{webr}\nlibrary(tidyverse) # Para manipular los datos\nlibrary(leaflet) # Para crear mapas interactivos\nlibrary(leaflet.extras) # Para crear extesiones en mapas interactivos\nlibrary(gstat) # Para realizar interpolaciones espaciales\nlibrary(raster) # Para trabajar con datos raster\nlibrary(igraph) # Para trabajar con grafos\nlibrary(tm) # Para trabajar con texto\nlibrary(wordcloud) # Para crear nubes de palabras\n```\n:::\n\n\n\n\n\n# Leemos los ficheros de datos y mostramos las primeras filas.\n\n\n\n::: {.cell}\n```{webr}\nantennas <- read_csv(\"datos/book_antennas.csv\")\nconnections <- read_csv(\"datos/book_connections.csv\")\nmessages <- read_csv(\"datos/book_messages.csv\")\n```\n:::\n\n\n\n\n# ¿Qué tipo de datos tenemos? ¿Cómo son las variables?\n\n\n\n::: {.cell}\n```{webr}\nhead(antennas)\nhead(connections)\nhead(messages)\n```\n:::\n\n\n\n\n# Geolocalización de las antenas y conexiones del movil objeto de interés.\n\n\n\n::: {.cell}\n```{webr}\nleaflet() |>\n  addTiles() |>\n  addCircleMarkers(data = antennas, ~longitude, ~latitude, \n                   color = \"red\", radius = ~ intensity / 10, \n                   label = ~ paste(\"Antena\", antenna_id)) |>\n  addCircleMarkers(data = connections, ~longitude, ~latitude, \n                   color = \"blue\", radius = ~ intensity / 10, \n                   label = ~ paste(\"Conexión\", connection_id))\n```\n:::\n\n\n\n\n# Análisis espacial de la intensidad de las antenas. Localización y tipo de variable.\n\n\n\n::: {.cell}\n```{webr}\nleaflet() |>\n  addTiles() |>\n  addCircleMarkers(data = antennas, ~longitude, ~latitude, \n                   color = \"red\", radius = ~ intensity / 5, \n                   label = ~ paste(\"Antena\", antenna_id))\n```\n:::\n\n\n\n\n# `Objetivo: mapa de cobertura.` Interpolación de la intensidad de las antenas para representar la cobertura de cada una de ellas. \n\n\n\n::: {.cell}\n```{webr}\n# Crear un objeto SpatialPointsDataFrame\ncoordinates(antennas) <- ~ longitude + latitude\n\n# Definir la proyección (WGS84)\nproj4string(antennas) <- CRS(\"+proj=longlat +datum=WGS84\")\n\n# Crear una cuadrícula para la interpolación\ngrd <- as.data.frame(spsample(antennas, \"regular\", n = 50000))\ncoordinates(grd) <- ~ x1 + x2 # (x + y)\ngridded(grd) <- TRUE\nproj4string(grd) <- proj4string(antennas)\n\n# Realizar la interpolación IDW\nidw <- idw(intensity ~ 1, antennas, grd)\n\n# Convertir el resultado a un objeto raster para la visualización\nr <- raster(idw)\n\n# Cargo los datos porque he sobreescrito el objeto antennas\nantennas <- read_csv(\"datos/book_antennas.csv\")\n\n# superponer la interpolación llamada r en el mapa leaflet\nleaflet() |>\n  addTiles() |>\n  addRasterImage(r, colors = terrain.colors(10), opacity = 0.8) |>\n  addCircleMarkers(data = antennas, ~longitude, ~latitude, \n                   color = \"red\", radius = ~ intensity / 5, \n                   label = ~ paste(\"Antena\", antenna_id)) # |>\n  # añadir la localización de los móviles\n  # addCircleMarkers(data = connections, ~longitude, ~latitude, \n  #                 color = \"blue\", radius = ~ intensity / 5, \n  #                 label = ~ paste(\"Conexión\", connection_id))\n```\n:::\n\n\n\n\n# ¿Con quién se relaciona el sospechoso, que conocido con el pseudónimo de **Laplace**?\n\n\n\n::: {.cell}\n```{webr}\ngraph_data <- messages |>\n  dplyr::select(sender, receiver) |>\n  graph_from_data_frame(directed = TRUE)\n\nplot(graph_data, \n     vertex.size = 10, \n     vertex.label.cex = 0.8, \n     edge.arrow.size = 0.5)\n```\n:::\n\n\n\n# ¿Y si mejoramos el grafo teniendo en cuenta la centraliada del nodo, es decir, la importancia de cada actor? \n\n\n\n::: {.cell}\n```{webr}\nplot(graph_data, \n     vertex.size = degree(graph_data), \n     vertex.label.cex = 0.8, \n     edge.arrow.size = 0.5)\n```\n:::\n\n\n\n# ¿De qué habla Laplace en sus mensajes de texto con el teléfono móvil?\n\n## Preparación del texto:\n\n\n\n::: {.cell}\n```{webr}\ncorpus <- Corpus(VectorSource(messages$message))\ncorpus <- tm_map(corpus, content_transformer(tolower))\ncorpus <- tm_map(corpus, removePunctuation)\ncorpus <- tm_map(corpus, removeNumbers)\ncorpus <- tm_map(corpus, removeWords, stopwords(\"spanish\"))\ncorpus <- tm_map(corpus, stripWhitespace)\n\ndtm <- TermDocumentMatrix(corpus)\nmatrix <- as.matrix(dtm)\nwords <- sort(rowSums(matrix), decreasing = TRUE)\ndf <- data.frame(word = names(words), freq = words)\n```\n:::\n\n\n\n## Nube de palabras:\n\n\n\n::: {.cell}\n```{webr}\nwordcloud(words = df$word, \n          freq = df$freq, \n          min.freq = 1, \n          random.order = FALSE, \n          colors = brewer.pal(8, \"Dark2\")\n          )\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}